var fs = require('fs');
var pdf = require('html-pdf');
//var html = fs.readFileSync('./test/businesscard.html', 'utf8');
var options = {
  format: 'A4',
  border: {
    "top": "2cm",
    "right": "1cm",
    "bottom": "2cm",
    "left": "1cm"
  }
};

module.exports = function(app){

  function formatDateBr(dt) {
    let data = new Date(dt);
    let dia = data.getDate();
    let mes = data.getMonth()+1;
    dia = str_pad(dia, 2, 0, "STR_PAD_LEFT");
    mes = str_pad(mes, 2, 0, "STR_PAD_LEFT");
    return `${dia}/${mes}/${data.getFullYear()}`;
  }

  function number_format (valor, decimals, decPoint, thousandsSep) {
    valor = (valor + '').replace(/[^0-9+\-Ee.]/g, '')
    var n = !isFinite(+valor) ? 0 : +valor
    var prec = !isFinite(+decimals) ? 0 : Math.abs(decimals)
    var sep = (typeof thousandsSep === 'undefined') ? ',' : thousandsSep
    var dec = (typeof decPoint === 'undefined') ? '.' : decPoint
    var s = ''

    var toFixedFix = function (n, prec) {
      var k = Math.pow(10, prec)
      return '' + (Math.round(n * k) / k)
        .toFixed(prec)
    }

    // @todo: for IE parseFloat(0.55).toFixed(0) = 0;
    s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.')
    if (s[0].length > 3) {
      s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep)
    }
    if ((s[1] || '').length < prec) {
      s[1] = s[1] || ''
      s[1] += new Array(prec - s[1].length + 1).join('0')
    }

    return s.join(dec)
  }

  function str_pad (input, padLength, padString, padType) {
    // eslint-disable-line camelcase
    //  discuss at: http://locutus.io/php/str_pad/
    // original by: Kevin van Zonneveld (http://kvz.io)
    // improved by: Michael White (http://getsprink.com)
    //    input by: Marco van Oort
    // bugfixed by: Brett Zamir (http://brett-zamir.me)
    //   example 1: str_pad('Kevin van Zonneveld', 30, '-=', 'STR_PAD_LEFT')
    //   returns 1: '-=-=-=-=-=-Kevin van Zonneveld'
    //   example 2: str_pad('Kevin van Zonneveld', 30, '-', 'STR_PAD_BOTH')
    //   returns 2: '------Kevin van Zonneveld-----'

    var half = ''
    var padToGo

    var _strPadRepeater = function (s, len) {
      var collect = ''

      while (collect.length < len) {
        collect += s
      }
      collect = collect.substr(0, len)

      return collect
    }

    input += ''
    padString = padString !== undefined ? padString : ' '

    if (padType !== 'STR_PAD_LEFT' && padType !== 'STR_PAD_RIGHT' && padType !== 'STR_PAD_BOTH') {
      padType = 'STR_PAD_RIGHT'
    }
    if ((padToGo = padLength - input.length) > 0) {
      if (padType === 'STR_PAD_LEFT') {
        input = _strPadRepeater(padString, padToGo) + input
      } else if (padType === 'STR_PAD_RIGHT') {
        input = input + _strPadRepeater(padString, padToGo)
      } else if (padType === 'STR_PAD_BOTH') {
        half = _strPadRepeater(padString, Math.ceil(padToGo / 2))
        input = half + input + half
        input = input.substr(0, padLength)
      }
    }

    return input
  }

  app.get('/pdf/gerar/:id', function(req, res){

    let id = req.params.id;
    let imagem = `${req.protocol}://${req.get('host')}/public/pdf/imagem/logo_gestao.png`;
    let name = new Date().toISOString();
    name = `relatorio_${name}.pdf`;

    //console.log("name", name);
    //console.log("imagem", imagem);
    //console.log("id", id);

    //let html = `<!DOCTYPE html><html> <head> <meta charset="UTF-8"> <title>teste</title> <style type="text/css"> body { width: 500px; font-size: 7px } .tbl-dependentes { width: 100%; border-collapse: collapse; } .tbl-dependentes td{ border: 1px solid lightgray; padding: 5px } .tbl-dependentes thead { background: rgba(0, 0, 0, 0.1); } </style> </head> <body style="margin: 0px; padding: 0px;"> <table style="width: 100%"> <thead> <tr> <td style="width: 10%"> <img src="http://localhost:3100/public/pdf/imagem/logo_gestao.png" style="width: 100%;"> </td> <td style="width: 90%"> <p style="text-align: center;">SECRETARIA MUNICIPAL DE DESENVOLVIMENTO SOCIAL E HABITAÇÃO - SEDESH</p> <p style="text-align: center;">CADASTRO HABITACIONAL</p> </td> </tr> </thead> </table> <hr /> <table style="width: 100%"> <tbody> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Titular 1:</span> <span style="padding-left: 5px">Nori Vettorello</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Naturalidade:</span> <span style="padding-left: 5px">Lajeado</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Pai:</span> <span style="padding-left: 5px">Luduvico Orlando Vettorello</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Mãe:</span> <span style="padding-left: 5px">Irma Maria Corbeline Vettorello</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Data Nascimento:</span> <span style="padding-left: 5px">31/01/1951</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Estado Civil:</span> <span style="padding-left: 5px">Viúvo(a)</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Escolaridade:</span> <span style="padding-left: 5px">Fundamental Incompleto</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">CPF:</span> <span style="padding-left: 5px">111.111.111-11</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">RG:</span> <span style="padding-left: 5px">1234567890</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Atividade:</span> <span style="padding-left: 5px">Impressor</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Renda:</span> <span style="padding-left: 5px">2.000,00</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Informal:</span> <span style="padding-left: 5px">Não</span> <span style="font-weight: bold;">Formal:</span> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Empresa:</span> <span style="padding-left: 5px">Box Print</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Titular 2:</span> <span style="padding-left: 5px">Iloni Angela Zanatta Vettorello</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Naturalidade:</span> <span style="padding-left: 5px">Lajeado</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Pai:</span> <span style="padding-left: 5px">Amadeu Zanatta</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Mãe:</span> <span style="padding-left: 5px">Otília Favaretto Zanatta</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Data Nascimento:</span> <span style="padding-left: 5px">10/08/1957</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Estado Civil:</span> <span style="padding-left: 5px">Casada</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Escolaridade:</span> <span style="padding-left: 5px">Superior Incompleto</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">CPF:</span> <span style="padding-left: 5px">111.111.111-11</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">RG:</span> <span style="padding-left: 5px">1234567890</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Atividade:</span> <span style="padding-left: 5px">Funcionária Pública</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Renda:</span> <span style="padding-left: 5px">2.000,00</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Informal:</span> <span style="padding-left: 5px">Não</span> <span style="font-weight: bold;">Formal:</span> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Empresa:</span> <span style="padding-left: 5px">Prefeitura de Campo Bom</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Telefones:</span> <span style="padding-left: 5px">(51)3597-3705 / (51)98315-1515</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Tempo de moradia em Campo Bom</span> <span style="padding-left: 10px; padding-right: 10px;"> 3 anos e 6 meses</span> <span style="font-weight: bold;">Município de procedência</span> <span style="padding-left: 10px; padding-right: 10px;">Lajeado</span> <span style="font-weight: bold;">UF de procedência</span> <span style="padding-left: 10px; padding-right: 10px;">RS</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Possui inscrição em Cooperativa sem definição do lote:</span> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Moradia atual:</span> <span style="padding-left: 5px">Alugada</span> <span style="font-weight: bold;">Nome de Ocupação:</span> <span style="padding-left: 5px">Morada das Almas</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">Família Constituida:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">Idoso Sozinho:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">PCD Sozinho:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD cadeirante:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD chefe da família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Qual PCD há na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sei lá</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave chefe da família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Qual Doença Grave há na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sei lá</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Participa de Programas</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Bolsa Família:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Valor:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">R$ 1.000,00</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">BPC:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Valor:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">R$ 1.000,00</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Inscrito Cadastro Único:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Número da Inscrição:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">123456</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">CRAS:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">CAPS:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Associação de Moradores:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Composição Familiar</span> </p> </td> </tr> <tr> <td> <table class="tbl-dependentes"> <thead> <tr> <td>Nome Completo</td> <td>Vínculo</td> <td>Data Nascimento</td> <td>CPF/RG/CN</td> <td>Escolaridade</td> <td>Atividade</td> <td>Renda</td> </tr> </thead> <tbody> <tr> <td>Igor Guilherme Vettorello</td> <td>Filho</td> <td>01/04/1983</td> <td>001.325.830-38</td> <td>Superior Completo</td> <td>Funcionário Público</td> <td>1.700,00</td> </tr> <tr> <td>Sabrini Vettorello</td> <td>Filha</td> <td>02/05/1985</td> <td>000.000.000-00</td> <td>Superior Completo</td> <td>Funcionária Pública</td> <td>3.500,00</td> </tr> </tbody> <tfoot> <tr> <td colspan="6">Número de Membros da família: 2</td> <td>5.200,00</td> </tr> </tfoot> </table> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; text-align: center;"> <span>Declaro que não possuo nenhum imóvel a nível de território nacional como titular, promitente comprador ou secionário, de apartamento, de lote, de gleba, individual ou em condomínio.</span> </p> <p style="margin: 0px; text-align: center;"> <span>Declaro também que as informações por mim prestadas nesta ficha são a expressão de verdade. A documentação que apresento será disponibilizada por mim no momento da contratação, caso seja beneficiado. A presente declaração é feita sob as penas da lei, portanto, em caso de falsidade o declarante ficará sujeito às sanções criminais, civis, administrativas previstas na legislação própria.</span> </p> </td> </tr> <tr> <td> <p style="border-top: 1px solid black; width: 50%; text-align: center; margin-left: 25%;">Assinatura do Titular</p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Documentos Apresentados</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de Residência:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de do tempo em Campo Bom:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">CPF e RG dos titulares:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de Renda:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de deficiência ou doença grave:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Observação:</span> <span style="padding-left: 5px">Não há observações a se fazer</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <br /><br /> <p style="border-top: 1px solid black; width: 50%; text-align: center; margin-left: 25%;">Responsável pelo preenchimento</p> </td> </tr> </tbody> </table> </body></html>`;
    //pdf.create(html, options).toFile(`./public/pdf/${name}`, function(err, res) {
    //  if (err) return console.log(err);
    //  console.log(res); // { filename: '/app/businesscard.pdf' }
    //});

    let connection = app.persistencia.connectionFactory();
    let habitacoesDAO = new app.persistencia.HabitacoesDAO(connection);
    habitacoesDAO.getById(id, (error, result) => {
      if (error) {
        let msg = {msg: "Registro não encontrado."};
        connection.end();
        res.status(404).json(msg);
      } else {
        if (result.length == 0) {
          let msg = {msg: "Registro não encontrado."};
          connection.end();
          res.status(404).json(msg);
        } else if (result.length > 1){
          let msg = {msg: "Erro Interno. Nossa equipe irá verificar essa inconsistência."};
          connection.end();
          res.status(500).json(msg);
        } else {
          let habitacao = result[0];
          let composicaoFamiliarDAO = new app.persistencia.ComposicaoFamiliarDAO(connection);
          composicaoFamiliarDAO.getByHabitacaoId(id, (error, result) => {
            if (error) {
              let msg = {msg: "Registro não encontrado."};
              connection.end();
              res.status(404).json(msg);
            } else {

              habitacao.id = str_pad(habitacao.id, 9, 0, "STR_PAD_LEFT");
              habitacao.gerado = formatDateBr(habitacao.createdAt);

              habitacao.nascimento_1 = (habitacao.nascimento_1 != "") ? formatDateBr(habitacao.nascimento_1) : "";
              habitacao.renda_1 = (habitacao.renda_1 != "") ? number_format(habitacao.renda_1, 2, ',', '.') : "";
              habitacao.informal_1 = (habitacao.informal_1) ? "Sim" : "Não";
              habitacao.formal_1 = (habitacao.formal_1) ? "Sim" : "Não";
              habitacao.nascimento_2 = (habitacao.nascimento_2 != "") ? formatDateBr(habitacao.nascimento_2) : "";
              habitacao.renda_2 = (habitacao.renda_2 != "") ? number_format(habitacao.renda_2, 2, ',', '.') : "";
              habitacao.informal_2 = (habitacao.informal_2) ? "Sim" : "Não";
              habitacao.formal_2 = (habitacao.formal_2) ? "Sim" : "Não";

              habitacao.cooperativa_inscricao = (habitacao.cooperativa_inscricao) ? "Sim" : "Não";
              habitacao.familia_constituida = (habitacao.familia_constituida) ? "Sim" : "Não";
              habitacao.idoso_sozinho = (habitacao.idoso_sozinho) ? "Sim" : "Não";
              habitacao.pcd_sozinho = (habitacao.pcd_sozinho) ? "Sim" : "Não";
              habitacao.pcd = (habitacao.pcd) ? "Sim" : "Não";
              habitacao.pcd_cadeirante = (habitacao.pcd_cadeirante) ? "Sim" : "Não";
              habitacao.pcd_familia = (habitacao.pcd_familia) ? "Sim" : "Não";
              habitacao.pcd_chefe_familia = (habitacao.pcd_chefe_familia) ? "Sim" : "Não";
              habitacao.doenca_grave = (habitacao.doenca_grave) ? "Sim" : "Não";
              habitacao.doenca_grave_familia = (habitacao.doenca_grave_familia) ? "Sim" : "Não";
              habitacao.doenca_grave_chefe_familia = (habitacao.doenca_grave_chefe_familia) ? "Sim" : "Não";
              habitacao.bolsa_familia = (habitacao.bolsa_familia) ? "Sim" : "Não";
              habitacao.inscrito_cadastro_unico = (habitacao.inscrito_cadastro_unico) ? "Sim" : "Não";
              habitacao.bcp = (habitacao.bcp) ? "Sim" : "Não";
              habitacao.beneficio_idoso_deficiente = (habitacao.beneficio_idoso_deficiente) ? "Sim" : "Não";
              habitacao.cras = (habitacao.cras) ? "Sim" : "Não";
              habitacao.caps = (habitacao.caps) ? "Sim" : "Não";
              habitacao.associacao_moradores = (habitacao.associacao_moradores) ? "Sim" : "Não";
              habitacao.comprovante_residencia = (habitacao.comprovante_residencia) ? "Sim" : "Não";
              habitacao.comprovante_tempo_campo_bom = (habitacao.comprovante_tempo_campo_bom) ? "Sim" : "Não";
              habitacao.comprovante_cpf_rg = (habitacao.comprovante_cpf_rg) ? "Sim" : "Não";
              habitacao.comprovante_renda = (habitacao.comprovante_renda) ? "Sim" : "Não";
              habitacao.comprovante_deficiencia_doenca_grave = (habitacao.comprovante_deficiencia_doenca_grave) ? "Sim" : "Não";

              habitacao.bolsa_familia_valor = (habitacao.bolsa_familia_valor != "") ? number_format(habitacao.bolsa_familia_valor, 2, ',', '.') : "";
              habitacao.bcp_valor = (habitacao.bcp_valor != "") ? number_format(habitacao.bcp_valor) : "";

              let str = "";
              if (result.length > 0) {
                let total = 0;
                let qtd = result.length;
                str = result.map(item => {
                  total += item.renda;
                  item.dt_nascimento = (item.dt_nascimento != "") ? formatDateBr(item.dt_nascimento) : "";
                  item.renda = (item.renda != "") ? number_format(parseFloat(item.renda)) : "";
                  return `<tr> <td>${item.nome_completo}</td> <td>${item.vinculo}</td> <td>${item.dt_nascimento}</td> <td>${item.cpf_rg_cn}</td> <td>${item.escolaridade}</td> <td>${item.atividade}</td> <td>${item.renda}</td> </tr>`;
                }).join(``);
                total = number_format(parseFloat(total));
                str = `<table class="tbl-dependentes"> <thead> <tr> <td>Nome Completo</td> <td>Vínculo</td> <td>Data Nascimento</td> <td>CPF/RG/CN</td> <td>Escolaridade</td> <td>Atividade</td> <td>Renda</td> </tr> </thead> <tbody> ${str} </tbody> <tfoot> <tr> <td colspan="6">Número de Membros da família: ${qtd}</td> <td>${total}</td> </tr> </tfoot> </table>`;
              } else {
                str = "Não há registros.";
              }

              let html = `<!DOCTYPE html><html> <head> <meta charset="UTF-8"> <title>teste</title> <style type="text/css"> body { width: 530px; font-size: 7px } .tbl-dependentes { width: 100%; border-collapse: collapse; } .tbl-dependentes td{ border: 1px solid lightgray; padding: 5px } .tbl-dependentes thead { background: rgba(0, 0, 0, 0.1); } </style> </head> <body style="margin: 0px; padding: 0px;"> <table style="width: 100%"> <thead> <tr> <td style="width: 10%"> <img src="http://localhost:3100/public/pdf/imagem/logo_gestao.png" style="width: 100%;"> </td> <td style="width: 90%"> <p style="text-align: center;">SECRETARIA MUNICIPAL DE DESENVOLVIMENTO SOCIAL E HABITAÇÃO - SEDESH</p> <p style="text-align: center;">CADASTRO HABITACIONAL</p> </td> </tr> </thead> </table> <hr /> <table style="width: 100%"> <tbody> <tr> <td style="width: 33%"> <span style="font-weight: bold;">Número da Inscrição:</span> <span style="padding-left: 5px">${habitacao.id}</span> </td> <td style="width: 33%"> <span style="font-weight: bold;">Titular:</span> <span style="padding-left: 5px">${habitacao.titular}</span> </td> <td style="width: 33%"> <span style="font-weight: bold;">Data:</span> <span style="padding-left: 5px">${habitacao.gerado}</span> </td> </tr> </tbody> </table> <hr /> <table style="width: 100%"> <tbody> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Titular 1:</span> <span style="padding-left: 5px">${habitacao.titular_1}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Naturalidade:</span> <span style="padding-left: 5px">${habitacao.naturalidade_1}</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Pai:</span> <span style="padding-left: 5px">${habitacao.pai_1}</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Mãe:</span> <span style="padding-left: 5px">${habitacao.mae_1}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Data Nascimento:</span> <span style="padding-left: 5px">${habitacao.nascimento_1}</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Estado Civil:</span> <span style="padding-left: 5px">${habitacao.estado_civil_1}</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Escolaridade:</span> <span style="padding-left: 5px">${habitacao.escolaridade_1}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">CPF:</span> <span style="padding-left: 5px">${habitacao.cpf_1}</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">RG:</span> <span style="padding-left: 5px">${habitacao.rg_1}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Atividade:</span> <span style="padding-left: 5px">${habitacao.atividade_1}</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Renda:</span> <span style="padding-left: 5px">${habitacao.renda_1}</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Informal:</span> <span style="padding-left: 5px">${habitacao.informal_1}</span> <span style="font-weight: bold;">Formal:</span> <span style="padding-left: 5px">${habitacao.formal_1}</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Empresa:</span> <span style="padding-left: 5px">${habitacao.empresa_1}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Titular 2:</span> <span style="padding-left: 5px">${habitacao.titular_2}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Naturalidade:</span> <span style="padding-left: 5px">${habitacao.naturalidade_2}</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Pai:</span> <span style="padding-left: 5px">${habitacao.pai_2}</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Mãe:</span> <span style="padding-left: 5px">${habitacao.mae_2}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Data Nascimento:</span> <span style="padding-left: 5px">${habitacao.nascimento_2}</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Estado Civil:</span> <span style="padding-left: 5px">${habitacao.estado_civil_2}</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Escolaridade:</span> <span style="padding-left: 5px">${habitacao.escolaridade_2}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">CPF:</span> <span style="padding-left: 5px">${habitacao.cpf_2}</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">RG:</span> <span style="padding-left: 5px">${habitacao.rg_2}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Atividade:</span> <span style="padding-left: 5px">${habitacao.atividade_2}</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Renda:</span> <span style="padding-left: 5px">${habitacao.renda_2}</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Informal:</span> <span style="padding-left: 5px">${habitacao.informal_2}</span> <span style="font-weight: bold;">Formal:</span> <span style="padding-left: 5px">${habitacao.formal_2}</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Empresa:</span> <span style="padding-left: 5px">${habitacao.empresa_2}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Endereço:</span> <span style="padding-left: 5px">${habitacao.endereco} - ${habitacao.numero} | Bairro: ${habitacao.bairro}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Telefones:</span> <span style="padding-left: 5px">${habitacao.telefones}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Tempo de moradia em Campo Bom</span> <span style="padding-left: 10px; padding-right: 10px;"> ${habitacao.tempo_moradia_anos} ano(s) e ${habitacao.tempo_moradia_meses} mes(es)</span> <span style="font-weight: bold;">Município de procedência</span> <span style="padding-left: 10px; padding-right: 10px;">${habitacao.procedencia_municipio}</span> <span style="font-weight: bold;">UF de procedência</span> <span style="padding-left: 10px; padding-right: 10px;">${habitacao.procedencia_uf}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Possui inscrição em Cooperativa sem definição do lote:</span> <span style="padding-left: 5px">${habitacao.cooperativa_inscricao}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Moradia atual:</span> <span style="padding-left: 5px">${habitacao.moradia_atual}</span> <span style="font-weight: bold;">Nome de Ocupação:</span> <span style="padding-left: 5px">${habitacao.ocupacao}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">Família Constituida:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">${habitacao.familia_constituida}</span> </p> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">Idoso Sozinho:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">${habitacao.idoso_sozinho}</span> </p> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">PCD Sozinho:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">${habitacao.pcd_sozinho}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.pcd}</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD cadeirante:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.pcd_cadeirante}</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.pcd_familia}</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD chefe da família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.pcd_chefe_familia}</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Qual PCD há na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.pcd_qual}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.doenca_grave}</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.doenca_grave_familia}</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave chefe da família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.doenca_grave_chefe_familia}</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Qual Doença Grave há na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">${habitacao.doenca_grave_qual}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Participa de Programas</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Bolsa Família:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">${habitacao.bolsa_familia}</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Valor:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">R$ ${habitacao.bolsa_familia_valor}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">BPC:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">${habitacao.bcp}</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Valor:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">R$ ${habitacao.bcp_valor}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Inscrito Cadastro Único:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">${habitacao.inscrito_cadastro_unico}</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Número da Inscrição:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">${habitacao.inscricao_cadastro_unico}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">CRAS:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">${habitacao.cras}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">CAPS:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">${habitacao.caps}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Associação de Moradores:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">${habitacao.associacao_moradores}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Benefício Idoso ou Deficiente:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">${habitacao.beneficio_idoso_deficiente}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Composição Familiar</span> </p> </td> </tr> <tr> <td> ${str} </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; text-align: center;"> <span>Declaro que não possuo nenhum imóvel a nível de território nacional como titular, promitente comprador ou secionário, de apartamento, de lote, de gleba, individual ou em condomínio.</span> </p> <p style="margin: 0px; text-align: center;"> <span>Declaro também que as informações por mim prestadas nesta ficha são a expressão de verdade. A documentação que apresento será disponibilizada por mim no momento da contratação, caso seja beneficiado. A presente declaração é feita sob as penas da lei, portanto, em caso de falsidade o declarante ficará sujeito às sanções criminais, civis, administrativas previstas na legislação própria.</span> </p> </td> </tr> <tr> <td> <p style="border-top: 1px solid black; width: 50%; text-align: center; margin-left: 25%;">Assinatura do Titular</p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Documentos Apresentados</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de Residência:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">${habitacao.comprovante_residencia}</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de do tempo em Campo Bom:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">${habitacao.comprovante_tempo_campo_bom}</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">CPF e RG dos titulares:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">${habitacao.comprovante_cpf_rg}</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de Renda:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">${habitacao.comprovante_renda}</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de deficiência ou doença grave:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">${habitacao.comprovante_deficiencia_doenca_grave}</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Observação:</span> <span style="padding-left: 5px">${habitacao.observacao}</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <br /><br /> <p style="border-top: 1px solid black; width: 50%; text-align: center; margin-left: 25%;">Responsável pelo preenchimento</p> </td> </tr> </tbody> </table> </body></html>`;
              //let html = `<!DOCTYPE html><html> <head> <meta charset="UTF-8"> <title>teste</title> <style type="text/css"> body { width: 500px; font-size: 7px } .tbl-dependentes { width: 100%; border-collapse: collapse; } .tbl-dependentes td{ border: 1px solid lightgray; padding: 5px } .tbl-dependentes thead { background: rgba(0, 0, 0, 0.1); } </style> </head> <body style="margin: 0px; padding: 0px;"> <table style="width: 100%"> <thead> <tr> <td style="width: 10%"> <img src="http://localhost:3100/public/pdf/imagem/logo_gestao.png" style="width: 100%;"> </td> <td style="width: 90%"> <p style="text-align: center;">SECRETARIA MUNICIPAL DE DESENVOLVIMENTO SOCIAL E HABITAÇÃO - SEDESH</p> <p style="text-align: center;">CADASTRO HABITACIONAL</p> </td> </tr> </thead> </table> <hr /> <table style="width: 100%"> <tbody> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Titular 1:</span> <span style="padding-left: 5px">Nori Vettorello</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Naturalidade:</span> <span style="padding-left: 5px">Lajeado</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Pai:</span> <span style="padding-left: 5px">Luduvico Orlando Vettorello</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Mãe:</span> <span style="padding-left: 5px">Irma Maria Corbeline Vettorello</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Data Nascimento:</span> <span style="padding-left: 5px">31/01/1951</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Estado Civil:</span> <span style="padding-left: 5px">Viúvo(a)</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Escolaridade:</span> <span style="padding-left: 5px">Fundamental Incompleto</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">CPF:</span> <span style="padding-left: 5px">111.111.111-11</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">RG:</span> <span style="padding-left: 5px">1234567890</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Atividade:</span> <span style="padding-left: 5px">Impressor</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Renda:</span> <span style="padding-left: 5px">2.000,00</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Informal:</span> <span style="padding-left: 5px">Não</span> <span style="font-weight: bold;">Formal:</span> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Empresa:</span> <span style="padding-left: 5px">Box Print</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Titular 2:</span> <span style="padding-left: 5px">Iloni Angela Zanatta Vettorello</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Naturalidade:</span> <span style="padding-left: 5px">Lajeado</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Pai:</span> <span style="padding-left: 5px">Amadeu Zanatta</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Mãe:</span> <span style="padding-left: 5px">Otília Favaretto Zanatta</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Data Nascimento:</span> <span style="padding-left: 5px">10/08/1957</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Estado Civil:</span> <span style="padding-left: 5px">Casada</span> </p> <p style="margin: 0px; width: 33%; float: left;"> <span style="font-weight: bold;">Escolaridade:</span> <span style="padding-left: 5px">Superior Incompleto</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">CPF:</span> <span style="padding-left: 5px">111.111.111-11</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="font-weight: bold;">RG:</span> <span style="padding-left: 5px">1234567890</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Atividade:</span> <span style="padding-left: 5px">Funcionária Pública</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Renda:</span> <span style="padding-left: 5px">2.000,00</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Informal:</span> <span style="padding-left: 5px">Não</span> <span style="font-weight: bold;">Formal:</span> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 25%; float: left;"> <span style="font-weight: bold;">Empresa:</span> <span style="padding-left: 5px">Prefeitura de Campo Bom</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Telefones:</span> <span style="padding-left: 5px">(51)3597-3705 / (51)98315-1515</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Tempo de moradia em Campo Bom</span> <span style="padding-left: 10px; padding-right: 10px;"> 3 anos e 6 meses</span> <span style="font-weight: bold;">Município de procedência</span> <span style="padding-left: 10px; padding-right: 10px;">Lajeado</span> <span style="font-weight: bold;">UF de procedência</span> <span style="padding-left: 10px; padding-right: 10px;">RS</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Possui inscrição em Cooperativa sem definição do lote:</span> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 100%; float: left;"> <span style="font-weight: bold;">Moradia atual:</span> <span style="padding-left: 5px">Alugada</span> <span style="font-weight: bold;">Nome de Ocupação:</span> <span style="padding-left: 5px">Morada das Almas</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">Família Constituida:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">Idoso Sozinho:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 15%; float: left;"> <span style="font-weight: bold; width: 25%">PCD Sozinho:</span> </p> <p style="margin: 0px; width: 85%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD cadeirante:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">PCD chefe da família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Qual PCD há na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sei lá</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Doença Grave chefe da família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 30%; float: left;"> <span style="font-weight: bold; width: 25%">Qual Doença Grave há na família:</span> </p> <p style="margin: 0px; width: 70%; float: left;"> <span style="padding-left: 5px">Sei lá</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Participa de Programas</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Bolsa Família:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Valor:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">R$ 1.000,00</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">BPC:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Valor:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">R$ 1.000,00</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Inscrito Cadastro Único:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Número da Inscrição:</span> </p> <p style="margin: 0px; width: 50%; float: left;"> <span style="padding-left: 5px">123456</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">CRAS:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">CAPS:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Associação de Moradores:</span> </p> <p style="margin: 0px; width: 10%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Composição Familiar</span> </p> </td> </tr> <tr> <td> <table class="tbl-dependentes"> <thead> <tr> <td>Nome Completo</td> <td>Vínculo</td> <td>Data Nascimento</td> <td>CPF/RG/CN</td> <td>Escolaridade</td> <td>Atividade</td> <td>Renda</td> </tr> </thead> <tbody> <tr> <td>Igor Guilherme Vettorello</td> <td>Filho</td> <td>01/04/1983</td> <td>001.325.830-38</td> <td>Superior Completo</td> <td>Funcionário Público</td> <td>1.700,00</td> </tr> <tr> <td>Sabrini Vettorello</td> <td>Filha</td> <td>02/05/1985</td> <td>000.000.000-00</td> <td>Superior Completo</td> <td>Funcionária Pública</td> <td>3.500,00</td> </tr> </tbody> <tfoot> <tr> <td colspan="6">Número de Membros da família: 2</td> <td>5.200,00</td> </tr> </tfoot> </table> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; text-align: center;"> <span>Declaro que não possuo nenhum imóvel a nível de território nacional como titular, promitente comprador ou secionário, de apartamento, de lote, de gleba, individual ou em condomínio.</span> </p> <p style="margin: 0px; text-align: center;"> <span>Declaro também que as informações por mim prestadas nesta ficha são a expressão de verdade. A documentação que apresento será disponibilizada por mim no momento da contratação, caso seja beneficiado. A presente declaração é feita sob as penas da lei, portanto, em caso de falsidade o declarante ficará sujeito às sanções criminais, civis, administrativas previstas na legislação própria.</span> </p> </td> </tr> <tr> <td> <p style="border-top: 1px solid black; width: 50%; text-align: center; margin-left: 25%;">Assinatura do Titular</p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <p style="margin: 0px; width: 20%; float: left;"> <span style="font-weight: bold; width: 25%">Documentos Apresentados</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de Residência:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de do tempo em Campo Bom:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">CPF e RG dos titulares:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de Renda:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> <p style="margin: 0px; width: 60%; float: left;"> <span style="font-weight: bold; width: 25%">Comprovante de deficiência ou doença grave:</span> </p> <p style="margin: 0px; width: 40%; float: left;"> <span style="padding-left: 5px">Sim</span> </p> </td> </tr> <tr> <td> <p style="margin: 0px;"> <span style="font-weight: bold;">Observação:</span> <span style="padding-left: 5px">Não há observações a se fazer</span> </p> </td> </tr> <tr> <td> <hr /> </td> </tr> <tr> <td> <br /><br /> <p style="border-top: 1px solid black; width: 50%; text-align: center; margin-left: 25%;">Responsável pelo preenchimento</p> </td> </tr> </tbody> </table> </body></html>`;
              pdf.create(html, options).toFile(`./public/pdf/${name}`, function(error, result) {
                if (error) {
                  console.log("error pdf", error);
                  let msg = {msg: "Ocorreu um erro interno e não foi possível gerar o pdf. Por favor contatar o CPD"};
                  connection.end();
                  res.status(500).json(msg);
                } else {
                  let __pdf = `${req.protocol}://${req.get('host')}/public/pdf/${name}`;
                  let msg = {filename: __pdf };
                  connection.end();
                  res.status(201).json(msg);
                }
              });
            }
          });
        }
      }
    });
  });
}